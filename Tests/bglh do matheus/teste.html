<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Color Analysis</title>
    <style>
      body {
        background: rgb(5, 6, 30);
      }
      #gradientDiv {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <img
      id="imgSong"
      src="/Assets/Images/Capas_astro_podcast/5.png"
      alt="Image"
    />
    <section id="gradientDiv"></section>

    <script>
      const imgSong = document.getElementById("imgSong");
      const gradientDiv = document.getElementById("gradientDiv");
      const defaultColor = "rgb(255, 255, 255)";

      if (!gradientDiv) {
        console.error("The 'gradientDiv' element is not found.");
      } else {
        imgSong.addEventListener("load", analiseDaImagem);

        function analiseDaImagem() {
          const imagem = new Image();
          imagem.src = imgSong.src;

          imagem.onload = function () {
            const canvas = document.createElement("canvas");
            canvas.width = imagem.width;
            canvas.height = imagem.height;

            const ctx = canvas.getContext("2d");
            ctx.drawImage(imagem, 0, 0, imagem.width, imagem.height);

            const imageData = ctx.getImageData(
              0,
              0,
              imagem.width,
              imagem.height
            );
            const pixels = imageData.data;

            const contaCor = {};

            for (let i = 0; i < pixels.length; i += 4) {
              const r = pixels[i];
              const g = pixels[i + 1];
              const b = pixels[i + 2];

              const rgb = `rgb(${r},${g},${b})`;
              contaCor[rgb] = contaCor[rgb] ? contaCor[rgb] + 1 : 1;
            }

            const predominanteCor = Object.keys(contaCor).reduce((a, b) =>
              contaCor[a] > contaCor[b] ? a : b
            );

            // Create a gradient background with the predominant color and the default color
            const gradient = `linear-gradient(to bottom, ${predominanteCor}, ${defaultColor})`;
            gradientDiv.style.backgroundImage = gradient;
          };
        }
      }
    </script>
  </body>
</html>
